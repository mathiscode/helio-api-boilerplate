!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.Helio=o():e.Helio=o()}(global,function(){return function(e){var o={};function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)t.d(n,r,function(o){return e[o]}.bind(null,r));return n},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=12)}([function(e,o){e.exports=require("winston")},function(e,o){e.exports=require("express")},function(e,o){e.exports=require("mongoose")},function(e,o){e.exports=require("body-parser")},function(e,o){e.exports=require("events")},function(e,o){e.exports=require("figlet")},function(e,o){e.exports=require("jsonwebtoken")},function(e,o){e.exports=require("winston-console-format")},function(e,o){e.exports=require("express-rate-limit")},function(e,o){e.exports=require("winston-mongodb")},function(e,o){e.exports=require("cors")},function(e){e.exports={name:"helio-api-boilerplate",version:"0.8.0",description:"Extensible backend boilerplate utilizing Express.js, Mongoose, JWT, and User registration/authentication",author:"J.R. Mathis (https://github.com/mathiscode)",license:"MIT",homepage:"https://github.com/mathiscode/helio-api-boilerplate#readme",main:"dist/index.js",bin:{helio:"./dist/bin/helio"},keywords:["nodejs","express","jwt","mongoose","mongodb","boilerplate","api-server"],scripts:{dev:'concurrently "webpack --watch" "npm run server"',start:"npm run server:prod",server:"cross-env NODE_ENVIRONMENT=development nodemon --exec babel-node  --require node_modules/dotenv/config src/bin/helio","server:prod":"cross-env NODE_ENVIRONMENT=production node dist/bin/helio",webpack:"webpack",build:"cross-env NODE_ENV=production npm-run-all webpack build:mods","build:mods":"babel src/mods --out-dir dist/mods","version:patch":"npm version patch","version:minor":"npm version minor","version:major":"npm version major",push:"git push && npm publish",test:"eslint src && cross-env NODE_ENV=testing PORT=0 mocha --require @babel/register --require dotenv/config --exit","test:mods":"npm-run-all test:mods:users test:mods:blog","test:mods:users":"newman run -e test/postman/postman_environment.json test/postman/collections/UsersMod.json","test:mods:blog":"newman run -e test/postman/postman_environment.json test/postman/collections/BlogMod.json","test:mods:staging":"npm-run-all test:mods:staging:users test:mods:staging:blog","test:mods:staging:users":"newman run -e test/postman/postman_environment_staging.json test/postman/collections/UsersMod.json","test:mods:staging:blog":"newman run -e test/postman/postman_environment_staging.json test/postman/collections/BlogMod.json","test:mods:prod":"npm-run-all test:mods:prod:users test:mods:prod:blog","test:mods:prod:users":"newman run -e test/postman/postman_environment_prod.json test/postman/collections/UsersMod.json","test:mods:prod:blog":"newman run -e test/postman/postman_environment_prod.json test/postman/collections/BlogMod.json",commit:"commit-wizard","snyk-protect":"snyk protect","prepublish-disabled":"npm run snyk-protect"},repository:{type:"git",url:"git+https://github.com/mathiscode/helio-api-boilerplate.git"},bugs:{url:"https://github.com/mathiscode/helio-api-boilerplate/issues"},engines:{node:">=11.6.0"},standard:{ignore:["/dist"]},dependencies:{"@babel/polyfill":"^7.4.4",bcryptjs:"^2.4.3","body-parser":"^1.19.0",commander:"^2.20.0","connect-mongo":"^3.2.0","cross-env":"^5.2.0",dotenv:"^8.0.0",express:"^4.16.4","express-jwt":"^5.3.1","express-rate-limit":"^4.0.1","express-session":"^1.17.1",figlet:"^1.2.4","helio-app-authentication":"file:../helio-apps/helio-app-authentication","helio-app-react-template":"file:../helio-apps/helio-app-react-template","helio-mod-jokes":"^1.0.0","helio-mod-users":"^1.1.1",jsonwebtoken:"^8.5.1",mongoose:"^5.5.4","npm-run-all":"^4.1.5",snyk:"^1.231.0",uuid:"^3.3.2",winston:"^3.2.1","winston-console-format":"^1.0.5","winston-mongodb":"^5.0.0"},devDependencies:{"@babel/cli":"^7.4.4","@babel/core":"^7.4.4","@babel/node":"^7.2.2","@babel/preset-env":"^7.4.4","@babel/register":"^7.4.4","babel-loader":"^8.0.6",chai:"^4.2.0","chai-http":"^4.3.0","clean-webpack-plugin":"^2.0.2",concurrently:"^4.1.2","copy-webpack-plugin":"^5.0.3",cors:"^2.8.5","create-file-webpack":"^1.0.2",eslint:"^5.16.0","eslint-config-standard":"^12.0.0","eslint-plugin-import":"^2.17.2","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.1.1","eslint-plugin-standard":"^4.0.0",mocha:"^6.1.4",newman:"^4.5.0",nodemon:"^1.18.11","pre-git":"^3.17.1",standard:"^12.0.1",webpack:"^4.32.2","webpack-cli":"^3.3.2","webpack-node-externals":"^1.7.2"},resolutions:{"set-value":"^2.0.1"},release:{analyzeCommits:"simple-commit-message"},config:{"pre-git":{"pre-commit":["npm run build","npm test","git add ."]}},snyk:!0}},function(e,o,t){"use strict";t.r(o);t(13);var n=t(4),r=t.n(n),s=t(5),i=t.n(s),a=t(1),l=t.n(a),p=t(3),u=t.n(p),c=t(2),m=t.n(c),d=t(6),f=t.n(d),g=t(0),b=t.n(g),h=t(7),v=t(8),O=t.n(v),y=t(9),w=t(10),_=t.n(w),E=t(11);function j(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function x(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function I(e,o){return!o||"object"!==L(o)&&"function"!=typeof o?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):o}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,o){return(S=Object.setPrototypeOf||function(e,o){return e.__proto__=o,e})(e,o)}var k=function(e){function o(){return T(this,o),I(this,R(o).apply(this,arguments))}return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),o&&S(e,o)}(o,r.a),o}(),M=function(){function e(o){var t=this;T(this,e),(o=this.options=o||{}).middleware="function"==typeof o.middleware?[o.middleware]:o.middleware,o.middleware=Array.isArray(o.middleware)?o.middleware:[],this.apps=o.apps||[],this.routes=o.routes||[];var n=this.app=l()();n.set("HELIO_DB_URI",o.dbUri||process.env.DB_URI),n.set("HELIO_JWT_SECRET",o.jwtSecret||process.env.JWT_SECRET),n.set("HELIO_JWT_TIMEOUT",o.jwtTimeout||process.env.JWT_TIMEOUT||"1h"),n.set("HELIO_LOG_TO_DB",o.logToDB||"true"===process.env.LOG_TO_DB),n.set("HELIO_CONSOLE_LOG",o.consoleLog||"true"===process.env.CONSOLE_LOG),n.set("HELIO_CONSOLE_ERRORS",o.consoleErrors||"true"===process.env.CONSOLE_ERRORS),m.a.set("debug",o.mongooseDebug||"true"===process.env.MONGOOSE_DEBUG||!1);var r=!1;if(n.get("HELIO_DB_URI")||(r="You must pass dbUri option or have DB_URI environment variable"),n.get("HELIO_JWT_SECRET")||(r="You must pass jwtSecret option or have JWT_SECRET environment variable"),r)throw new Error(r);var s=o.logTransports||[];n.get("HELIO_LOG_TO_DB")&&s.push(new y.MongoDB({db:n.get("HELIO_DB_URI")})),s.push(new b.a.transports.Console({format:b.a.format.combine(b.a.format.colorize({all:!0}),b.a.format.padLevels(),Object(h.consoleFormat)({showMeta:!0,metaStrip:["timestamp","service"],inspectOptions:{depth:8,colors:!0,maxArrayLength:1/0,breakLength:120,compact:1/0}})),silent:!n.get("HELIO_CONSOLE_LOG")})),this.log=b.a.createLogger({level:this.options.logLevel||process.env.LOG_LEVEL||"silly",format:b.a.format.combine(b.a.format.timestamp(),b.a.format.ms(),b.a.format.errors({stack:!0}),b.a.format.splat(),b.a.format.json()),transports:s});var a=function(){t.connectDB(),t.initializeServer()};if(this.options.hideBanner)return a();i.a.text(this.options.bannerText||"Helio",{font:this.options.bannerFont||"The Edge",horizontalLayout:"default",verticalLayout:"default"},function(e,o){e&&t.log.silly("Unable to show banner:",e),e||console.log(o),a()})}var o,t,n;return o=e,(t=[{key:"connectDB",value:function(){var e=this,o=this.app.get("HELIO_DB_URI");"object"!==L(this.options.mongooseOptions)&&(this.options.mongooseOptions={}),this.options.mongooseOptions=function(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{},n=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(o){j(e,o,t[o])})}return e}({},{useNewUrlParser:!0,useFindAndModify:!1,useCreateIndex:!0,useUnifiedTopology:!0},this.options.mongooseOptions),this.db=m.a.connect(o,this.options.mongooseOptions).then(function(t){return e.log.verbose("Mongo Database:",{connected:!0,uri:o.replace(/:\w+/g,":****")})}).catch(function(o){e.log.error("Mongoose Connection Error:",o),e.log.error("Refusing to continue without usable database. Exiting."),process.exit(1)})}},{key:"initializeServer",value:function(){var e=this;this.log.silly("Server initializing",{helio:E.version});var o=this.app,t=this.options;o.disable("x-powered-by"),o.use(u.a.json()),o.use(u.a.urlencoded({extended:!0})),t.trustProxy&&o.set("trust proxy",1);var n=O()({windowMs:t.rateLimitWindow||process.env.RATE_LIMIT_WINDOW||9e5,max:t.rateLimitMaxRequestsPerWindow||process.env.RATE_LIMIT_MAX_REQUESTS_PER_WINDOW||100,skip:function(e,o){return"127.0.0.1"===e.ip||"::ffff:127.0.0.1"===e.ip||"::1"===e.ip||t.rateLimitExemptUrls.includes(e.url)}});t.disableRateLimiter||o.use(n),o.use(function(o,t,n){o.log=o.Log=e.log,o.db=e.db;var r=function(){var t={user:o.user||"*anonymous*",url:o.url,ip:o.ip,rate:o.rateLimit||1/0};e.log.silly("Incoming request:",t)};try{var s=o.headers.authorization?o.headers.authorization.split(" ")[1]:null;s&&f.a.verify(s,e.app.get("HELIO_JWT_SECRET"),function(n,s){if(n)o.user=null,e.log.warn(n.toString());else{var i=Math.floor((new Date(1e3*s.exp)-Date.now())/1e3/60);t.set("Token-Minutes-Remaining",i),o.user=s.data?s.data.uuid:null}r()})}catch(o){e.log.warn(o),r()}return n()}),t.middleware.forEach(function(e){return o.use(e)});var r=new k;this.log.verbose("Loading ".concat(this.apps?this.apps.length:0," apps")),this.apps&&this.apps.forEach(function(t){var n=l.a.Router();n.appComms=r;var s=new t.Loader(n,e.log,m.a,t.options||{});s.router=n,e.log.silly("Loading app:",{name:s.name,version:s.package?s.package.version:"unknown",root:s.root}),s&&s.corsAllowedOrigins&&s.corsAllowedOrigins.length>0&&o.use(s.root,_()({origin:function(o,t){if(!o)return t(null,!0);if(!s.corsAllowedOrigins.includes(o.replace(/\/$/,""))){e.log.warn("CORS Violation from Origin:",{origin:o,app:s.name,allowedOrigins:s.corsAllowedOrigins});return t(new Error("The CORS policy for this site does not allow access from the specified Origin."),!1)}return t(null,!0)}})),s.static&&o.use(s.root,l.a.static(s.static)),o.use(t.options&&t.options.root?t.options.root:s.root,s.router)});var s=[];this.routes.forEach(function(e){o.use(e.path,e.module),s.push(e.path)}),s.length>0&&this.log.info("Registered Core Routes:",{routes:s}),o.use(function(e,o,t){return o.status(404).json({error:"Invalid API method"})}),o.use(function(o,n,r,s){return t.consoleErrors&&"UnauthorizedError"!==o.name&&e.log.error("APP ERROR:",o),"UnauthorizedError"===o.name?r.status(401).json({error:"Invalid token"}):r.status(500).json({error:"Internal API error"})}),t.noListen||this.listen()}},{key:"listen",value:function(e){var o=this,t=this.options.port||process.env.PORT||3001,n=this.app.listen(t,function(){o.port=n.address().port,o.log.info("".concat(o.options.name||process.env.HELIO_NAME||"Helio API Server"," listening"),n.address()),"function"==typeof e&&e(n)})}}])&&x(o.prototype,t),n&&x(o,n),e}();o.default=M},function(e,o){e.exports=require("@babel/polyfill")}])});